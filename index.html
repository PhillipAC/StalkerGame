<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Stalker: Hide and Seek Game</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
        <style>
        </style>
    </head>
    <body>      
        <h1>Your Mission</h1>  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script>
            $.urlParam = function (name) {
                var results = new RegExp('[\?&]' + name + '=([^&#]*)')
                                .exec(window.location.search);

                return (results !== null) ? results[1] || 0 : false;
            }

            let Group = function(id, name)
            {
                this.id = id;
                this.name = name;
            };
            let Area = function(id, name, adjancentAreaIds, groupId){
                this.id = id;
                this.name = name;
                this.adjancentAreaIds = adjancentAreaIds;
                this.groupId = groupId;
            };
            let Room = function(id, name, areaId)
            {
                this.id = id;
                this.name = name;
                this.areaId = areaId;
            };

            let groups = [
                new Group(0, "Inside"),
                new Group(1, "Outside")
            ];
            let areas = [
                new Area(0, "Upstairs", [1], 0),
                new Area(1, "Ground Floor", [0,2], 0),
                new Area(2, "Basement", [1], 0),
                new Area(3, "Front Yard", [4], 1),
                new Area(4, "Back Yard", [3], 1)
            ];
            let rooms = [
                new Room(0, "Kid's Room", 0),
                new Room(1, "Bedroom", 0),
                new Room(2, "Front Bedroom", 1),
                new Room(3, "Common Bathroom", 1),
                new Room(4, "Kitchen", 1),
                new Room(5, "Living Room", 1),
                new Room(6, "Master Bedroom", 1),
                new Room(7, "Master Bathroom", 1),
                new Room(8, "Bedroom", 2),
                new Room(9, "Bathroom", 2),
                new Room(10, "Play Fort", 3),
                new Room(11, "Front of Driveway", 3),
                new Room(12, "Fire Pit", 4),
                new Room(13, "Boat House", 4)
            ];

            let selectRandomElement = function(array){
                let index = Math.floor(Math.random()*array.length);
                return array[index];
            }

            let outsideGroup = groups.find(g => g.name == "Outside");
            let insideGroup = groups.find(g => g.name == "Inside");

            let includeOutside = $.urlParam('includeOutside');
            
            filteredAreas = areas.filter(a => includeOutside || a.groupId != outsideGroup.id);
            
            let targetAreas = [];
            for(var i = 0; i < 3; i++)
            {
                optionalAreas = [];
                if(targetAreas.length != 0)
                {
                    lastArea = targetAreas[targetAreas.length -1];
                    optionalAreas = filteredAreas.filter(a => {
                        let index = a.adjancentAreaIds.findIndex(ad => ad == lastArea.id);
                        return index == -1});
                    if(optionalAreas.length == 0)
                    {
                        optionalAreas = filteredAreas;
                    }
                }
                else{
                    optionalAreas = filteredAreas;
                }
                targetArea = selectRandomElement(optionalAreas);
                filteredAreas = filteredAreas.filter(a => a.id != targetArea.id)
                targetAreas.push(targetArea);
            }

            let targetRooms = [];

            for(var i = 0; i < targetAreas.length; i++)
            {
                optionalRooms = rooms.filter(r => r.areaId == targetAreas[i].id);
                targetRooms.push(selectRandomElement(optionalRooms));
            }

            for(var i = 0; i < targetRooms.length; i++)
            {
                console.log(targetAreas[i].name + " : " + targetRooms[i].name);
            }

            $("body").append(`<div>Starting Area: ${targetAreas[0].name} - ${targetRooms[0].name}</div>`);
            $("body").append(`<div>Second Target: ${targetAreas[1].name} - ${targetRooms[1].name}</div>`);
            $("body").append(`<div>Finish: ${targetAreas[2].name} - ${targetRooms[2].name} </div>`);
        </script>
    </body>
</html>